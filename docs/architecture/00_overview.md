# Datapresso 框架架构概览

## 1. 框架目标

Datapresso是一个系统化的数据构建框架，旨在生成、评估和筛选高质量的小规模数据集（LIMO数据），用于高效的模型微调。框架的核心目标是解决传统大规模数据微调中的数据瓶颈和计算成本挑战，通过专注于数据质量、多样性和自动化评估，实现"少即是多"的数据效率。

## 2. 核心理念

- **质量优先**：少量高质量数据胜过大量低质量数据
- **多维度评估**：全面评估数据的多个质量维度
- **推理与答案分离**：分别评估推理过程和最终答案
- **多样性驱动**：确保数据覆盖多样的领域和难度
- **自动化流程**：减少人工干预，提高效率
- **可解释性**：提供透明的评估和筛选理由
- **闭环验证**：通过模型训练和评估验证数据有效性

## 3. 架构层次

Datapresso框架由8个核心层组成，形成完整的数据构建Pipeline：

1. **用户配置输入层**：接收和验证用户配置
2. **种子数据库层**：管理高质量基础数据集
3. **数据生成扩充层**：基于种子数据生成更多样本
4. **数据质量评估层**：对数据进行多维度质量评估
5. **数据多维度筛选层**：基于评估结果筛选数据
6. **高级评估与筛选层**：通过模型反馈进一步评估数据
7. **集成训练层**：使用筛选后的数据进行模型训练
8. **模型评估层**：评估训练效果

## 4. 数据流转

![Datapresso数据流转图](../assets/datapresso_flow.png)

数据在Pipeline中的流转遵循以下路径：

```
用户配置 → 种子数据 → 生成数据 → 质量评估 → 初步筛选 → 高级评估 → 最终数据集 → 模型训练 → 性能评估
```

在流转过程中，数据的元数据不断丰富，记录了数据的来源、质量评估结果、筛选理由等信息，确保整个过程的可追踪性和透明度。

## 5. 响应数据三部分结构

Datapresso框架的一个核心创新是将响应数据分为三个部分：

```json
"response": {
  "origin_text": "原始响应文本",
  "rationale": "推理过程",
  "final_answer": "最终答案"
}
```

这种分离设计允许：
- 分别评估推理质量和答案准确性
- 针对不同任务调整推理与答案的权重
- 提高模型的可解释性和透明度
- 支持更精细的质量评估和筛选策略

## 6. 关键特性

### 6.1 多维度质量评估

框架实现了多维度的质量评估体系，包括：
- 指令复杂度评估
- 响应质量评估
- 推理深度评估
- 安全性评分
- 技术验证（代码执行、数学验证等）

### 6.2 平衡的筛选策略

筛选策略平衡考虑：
- 质量维度：确保高质量数据
- 多样性维度：确保领域和难度的均衡覆盖
- 去重机制：避免数据冗余

### 6.3 高级评估方法

实现了多种高级评估方法：
- IFD（Instruction-Following Difficulty）
- LIMR（Learning-Induced Model Responses）
- LESS（Learning Effectiveness Score System）

### 6.4 模型训练与评估

支持多种训练策略：
- 完整响应训练
- 仅推理过程训练
- 仅最终答案训练
- 混合策略训练

## 7. 技术栈

- **编程语言**：Python 3.10+
- **数据格式**：JSON Lines
- **配置系统**：YAML/Hydra
- **模型集成**：Hugging Face Transformers
- **训练框架**：PyTorch/PEFT
- **评估工具**：自定义评估框架 + 标准基准

## 8. 扩展性

Datapresso框架设计为高度可扩展：
- 支持添加新的评估维度
- 支持集成新的生成模型
- 支持自定义筛选策略
- 支持扩展高级评估方法
- 支持集成不同的训练框架

## 9. 使用场景

- 资源受限环境下的模型微调
- 特定领域的专业模型开发
- 教育和研究环境中的模型实验
- 推理能力增强的模型训练
- 可解释性要求高的应用场景
